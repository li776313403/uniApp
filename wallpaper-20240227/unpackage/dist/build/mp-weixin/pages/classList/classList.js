"use strict";const e=require("../../common/vendor.js"),a=require("../../stores/layoutStore.js"),l=require("../../stores/dataStore.js"),t=require("../../api/wallpaper.js"),i=require("../../unit/basicData.js"),s=require("../../unit/queryAndParamHelper.js");if(require("../../unit/request.js"),!Array){(e.resolveComponent("uni-load-more")+e.resolveComponent("uni-icons"))()}Math||((()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js"))();const n=e.defineComponent({__name:"classList",setup(n){const u=a.useLayoutStore(),o=l.useDataStore(),r=e.computed((()=>o.classify)),d=e.computed({get:()=>o.wall,set:e=>o.setWallData(e)}),v=e.ref(!0),c=e.computed((()=>u.statusBarHeight||15)),p=e.computed((()=>u.dy_TitleLeftIconDistance)),m=e.ref({classId:"",wallId:"",type:null}),g=e.computed((()=>s.queryAndParamHelper.tansParams(m.value))),h=e.ref({classid:"",pageNum:1,pageSize:12}),f=e.computed((()=>{let e="";if(m.value.type){const a=r.value.filter((e=>e._id===m.value.classId));e=a.length>0?a[0].name:"未知分类"}else e="download"===m.value.type?"我的下载":"我的评分";return e})),w=()=>{(()=>{e.index.showLoading({title:"壁纸数据加载中...",mask:!0});const a=JSON.parse(JSON.stringify(h.value));return m.value.type?(delete a.classid,a.type=m.value.type,t.getUserWallList(a)):t.getWall(a)})().then((a=>{if(0===a.errCode){const l=d.value.map((e=>e._id)),t=a.data.filter((e=>!l.includes(e._id)));d.value=d.value.concat(t),v.value=h.value.pageSize===a.data.length,m.value.wallId&&(v.value?d.value.some((e=>e._id===m.value.wallId))?e.index.navigateTo({url:"/pages/preview/preview?"+g.value}).finally((()=>{e.index.hideLoading()})):x():e.index.showToast({icon:"fail",title:"未找到指定壁纸"}).finally((()=>{e.index.hideLoading()})))}else e.index.showToast({title:"获取壁纸数据失败",icon:"error"})})).catch((()=>{e.index.showToast({title:"获取壁纸数据失败",icon:"error"})})).finally((()=>{!m.value.wallId&&e.index.hideLoading()}))},x=()=>{h.value.pageNum++,w()},y=()=>{e.index.navigateBack().catch((()=>{e.index.switchTab({url:"/pages/index/index"})}))};return e.onLoad((a=>{a.classId&&(h.value.classid=a.classId),m.value=a,e.index.setNavigationBarTitle({title:f.value}),w()})),e.onUnload((()=>{o.setWallData(null)})),e.onReachBottom((()=>{v.value&&x()})),e.onPullDownRefresh((()=>{h.value.pageNum=1,w()})),e.onShareAppMessage((()=>({title:i.basicData.title+"-"+f.value,path:"/pages/classList/classList?"+g.value}))),e.onShareTimeline((()=>({title:i.basicData.title+"-"+f.value,query:g.value}))),(a,l)=>e.e({a:0===d.value.length&&v.value},0===d.value.length&&v.value?{b:e.p({status:"loading"}),c:c.value+"px"}:{},{d:e.p({type:"back",size:"20"}),e:e.o(y),f:c.value+"px",g:p.value+"px",h:e.f(d.value,((a,l,t)=>({a:a.smallPicurl,b:e.o((l=>{return t=a,m.value.wallId=t._id,void e.index.navigateTo({url:"/pages/preview/preview?"+g.value}).then((()=>{m.value.wallId=""}));var t}),a._id),c:a._id}))),i:d.value.length>0||!v.value},d.value.length>0||!v.value?{j:e.p({status:v.value?"loading":"noMore"})}:{})}});n.__runtimeHooks=6;const u=e._export_sfc(n,[["__scopeId","data-v-421a0f65"]]);wx.createPage(u);
